# asset-utils

마인크래프트 리소스 데이터 추출을 자동화하고 로컬 cdn 서버를 실행할 수 있는 내부 패키지입니다.

디스플레이 엔티티는 마인크래프트에 있는 블록과 아이템 모델 및 텍스쳐를 사용하기 때문에, 에디터에서도 해당 모델 정의 파일과 텍스쳐 이미지 파일이 필요합니다. 수많은 모델 .json 파일들과 텍스쳐 이미지 파일들을 이 리포지토리에 담기에는 여러 문제가 있어, 직접 추출하는 방식을 사용합니다.

로컬 CDN 서버는 메인 에디터에 필요한 리소스 파일들을 로컬에서 호스팅하기 위한 서버입니다. 글로벌 CDN 서버에 올리지 않고도 리소스가 잘 불러와지는지 빠르게 확인할 수 있습니다.

## 리소스 추출하기

### 준비물

- Node.js 20 이상
- 리소스 추출을 진행할 마인크래프트 버전에 맞는 Java
  - 버전에 따라 Java 17 또는 Java 21이 필요합니다.
- 인터넷 연결
  - Mojang CDN에서 client.jar, server.jar 및 기타 공통 리소스 파일을 다운받는 데 필요합니다.

### 방법

#### 일반 추출

1. 프로젝트 루트 폴더에서 아래 명령어를 실행합니다.

```bash
pnpm asset-utils generate <추출할 마인크래프트 버전>
```

2. 리소스 추출 및 저장이 완료될 때까지 기다립니다. 추출된 리소스 데이터는 `output/<마인크래프트 버전>`에 저장됩니다.

- 공통 리소스 데이터의 경우 `output/shared/<assetIndex>`에 저장됩니다.

#### 순차적(incremental) 추출

여러 마인크래프트 버전의 리소스들을 추출할 경우, 오래 전에 추가된 리소스들이 각 게임 버전마다 반복 추출되어 중복된 파일들이 많아지고 차지하는 용량이 커지는 문제가 발생합니다.
순차적 추출은 이번 버전에 추가되거나 변경된 파일만 추출하는 방식으로, 리소스 파일 중복을 방지합니다.

1. 프로젝트 루트 폴더에서 아래 명령어를 실행합니다.

```bash
pnpm asset-utils generate:incremental <추출할 마인크래프트 버전>
```

2. 리소스 추출 및 저장이 완료될 때까지 기다립니다. 추출된 리소스 데이터는 `output/<마인크래프트 버전>`에 저장됩니다.

- 순차적 추출을 실행하면 마인크래프트에 처음 디스플레이 엔티티가 추가된 `1.19.4`부터 `<추출할 마인크래프트 버전>`까지 차례대로 추출을 진행합니다.
- 하드웨어 성능 및 인터넷 속도에 따라 추출 시간이 길어질 수 있습니다.

## 로컬 CDN 서버 실행

로컬 CDN 서버는 [`serve`](https://npmjs.com/package/serve)를 사용하여 가동합니다. 아래 명령어를 입력하여 서버를 실행할 수 있습니다:

```bash
pnpm asset-utils serve
```

실행 후 http://localhost:3000 으로 접속하면 파일을 확인할 수 있습니다. 루트 폴더는 `output`입니다.
serve 서버의 옵션을 변경하고 싶다면 명령어 뒤에 argument로 지정하거나, `output/serve.json` 파일을 수정하면 됩니다.
